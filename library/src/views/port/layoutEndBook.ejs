</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script> 

const socket = io('/', {query: `bookId=${bookId}`});
const form = document.querySelector('#commentary-form');
const input = document.querySelector('#commentary-input');
const messages = document.querySelector('#commentary-messages');

form.onsubmit = (e) => {
    e.preventDefault();
    if (input.value) {
        socket.emit('commentary message', {msg: input.value});
        input.value = '';
    }
};

socket.on('commentary message', (message) => {
    const locale = Intl.DateTimeFormat().resolvedOptions();
    const item = document.createElement('li');
    item.classList = 'list-group-item';
    item.innerHTML = `
        <div class="d-flex w-100 justify-content-end">
            <small>${new Date(message.date).toLocaleString(locale.locale, { timeZone: locale.timeZone })}</small>
        </div>
        <p class="mb-1">${message.msg}</p>`;
    messages.appendChild(item);
    window.scrollTo(0, document.body.scrollHeight);
});
</script>


</body>
</html>